# Review2Earn (v3.0) 코드 리뷰 최종 보고서

**작성자**: Jules (AI Software Engineer)
**작성일**: 2025년 10월 8일
**검토 목표**: 제공된 v3.0 설계 문서와 현재 코드베이스의 일치 여부 검토 및 치명적 오류 식별 (코드 수정 없음)

---

## 1. 전체 결과 요약

현재 코드베이스는 설계 문서 v3.0에서 목표한 기능들이 아직 구현되지 않은 **초기 개발 단계**에 있습니다. 데이터베이스 연동에 `@vercel/postgres`와 Raw SQL 대신 `Prisma` ORM을 사용하는 등, 설계와 다른 주요 아키텍처 선택이 있었습니다.

가장 중요한 것은, v3.0의 핵심 기능인 **'제품별/쇼핑몰별 차등 보상 요율 시스템'이 아직 구현되지 않았다**는 점입니다. 현재 코드는 모든 보상을 고정된 단일 요율로만 처리하고 있어, 프로젝트의 핵심 목표를 달성하지 못하고 있습니다.

## 2. 발견된 치명적 오류

### 🚨 치명적 오류 #1: 하드코딩된 `mall_id`로 인한 데이터 오염

가장 시급하고 위험한 오류로, 리뷰와 주문 웹훅 모두에서 `mall_id`가 특정 값으로 하드코딩되어 있습니다.

-   **위치**: `src/app/api/webhooks/review/route.ts`, `src/app/api/webhooks/order/route.ts`
-   **문제 코드**: `const mallId = body.mall_id || 'dhdshop';`
-   **위험성**: 이 코드는 여러 쇼핑몰에서 앱을 사용할 경우, **A 쇼핑몰의 리뷰와 주문이 전부 B 쇼핑몰의 데이터로 잘못 저장**되는 심각한 데이터 오염을 일으킵니다. 이는 잘못된 보상 지급, 통계 오류 등 비즈니스 로직 전체를 망가뜨릴 수 있는 치명적인 결함입니다.

### 🚨 치명적 오류 #2: v3.0 핵심 보상 시스템의 완전한 누락

설계 문서 v3.0의 가장 핵심적인 기능인 **'제품별/쇼핑몰별 보상 요율 시스템'이 주문 처리 로직에 전혀 구현되어 있지 않습니다.**

-   **위치**: `src/app/api/webhooks/order/route.ts`
-   **문제 코드**: `const rewardRate = review.mall?.reviewerRewardRate ?? 0.01;`
-   **문제점**: 코드는 `product_rewards` 테이블을 조회하여 제품별 특별 요율을 적용하는 로직 없이, 단순히 쇼핑몰의 기본 요율이나 1% 고정값을 사용합니다. 이로 인해 "프리미엄 제품에 2% 요율 적용"과 같은 v3.0의 핵심 시나리오가 동작하지 않습니다.

### 🚨 치명적 오류 #3: 불완전한 비즈니스 로직 (구매자/플랫폼 보상 누락)

현재 보상 계산 로직은 설계된 비즈니스 모델을 완성시키기에 근본적으로 불완전합니다. 설계된 보상 모델은 `리뷰어(x%)`, `구매자(y%)`, `플랫폼(z%)` 세 부분으로 구성되지만, 현재 코드는 **리뷰어에게 지급될 적립금만 계산하고 저장**합니다. **구매자 할인 쿠폰**과 **플랫폼 수수료**에 대한 계산 및 저장이 완전히 누락되어 있습니다.

## 3. 기타 설계와 구현의 불일치점

-   **추천 코드 생성 방식**: 설계된 `nanoid` 대신 `crypto` 모듈 기반 해시 코드를 사용합니다.
-   **추천 경로 추적 방식**: 설계된 웹훅 페이로드 대신 불안정한 `referer` HTTP 헤더를 사용해 주문을 추적하고 있어 누락 위험이 큽니다.
-   **데이터베이스 기술 스택**: 설계된 `@vercel/postgres` 대신 `Prisma` ORM을 사용합니다.
-   **API 엔드포인트 부재**: 보상 요율 관리를 위한 `/api/rewards/*` API들이 존재하지 않습니다.
-   **용어 불일치**: 리뷰 고유 ID로 `board_no` (코드)와 `review_id`/`article_no` (문서)가 혼용되고 있습니다.

## 4. 최종 권고안

1.  **[긴급] `mall_id` 하드코딩 문제 즉시 해결**: 서비스 확장 시 즉시 데이터 오류를 발생시키므로 최우선으로 수정해야 합니다.
2.  **[핵심] v3.0 차등 보상 요율 시스템 구현**: 프로젝트 목표 달성을 위해 '제품별 > 쇼핑몰별 > 기본값' 우선순위를 따르는 보상 로직을 구현해야 합니다.
3.  **[보완] 전체 비즈니스 로직 완성**: 구매자 할인과 플랫폼 수수료 계산 로직을 추가하여 비즈니스 모델을 완성해야 합니다.

이상으로 코드 리뷰 보고를 마칩니다. 위 세 가지, 특히 첫 번째와 두 번째 항목을 최우선 과제로 삼아 개발을 진행하시는 것을 강력히 권고합니다.